<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>A-Yudi-Thea</title>

<style>
body{font-family:Arial;background:#f2f2f2;margin:0}

header{background:#0d47a1;color:white;padding:15px;text-align:center}

input{width:95%;margin:10px;padding:12px;font-size:16px}

.card{background:white;margin:10px;padding:12px;border-radius:8px}

.big{font-size:20px;font-weight:bold}

.harga{color:red;font-weight:bold}
.stok{color:green}
</style>
</head>

<body>

<header>
<h2>A-Yudi-Thea</h2>
<p>Dashboard & Stok Produk</p>
</header>

<!-- DASHBOARD -->
<h3>ðŸ“… Data Harian</h3>
<input type="date" id=" onchange="filterTanggal()">

<div class="card">Omset<div class="big" id="omset">Rp 0</div></div>
<div class="card">Pengeluaran<div class="big" id="keluar">Rp 0</div></div>
<div class="card">Laba<div class="big" id="laba">Rp 0</div></div>

<hr>

<!-- PENCARIAN PRODUK -->
<h3>ðŸ”ŽTarik ke bawah 1 kali (Refresh) Baru Lakukan Pencarian Produk</h3>
<input id="cari" placeholder="Cari nama / kode barang..." onkeyup="filterProduk()">

<div id="hasil"></div>

<script>
// ===== DASHBOARD =====
const sheetId="1iPbtRGldW5yz6tuUZ5oHzMGsnNb4cHyCbAEMkq51qK4";
const tabLaporan="FIX RUMUS";

fetch(`https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?sheet=${encodeURIComponent(tabLaporan)}`)
.then(r=>r.text())
.then(t=>{
const json=JSON.parse(t.substring(47).slice(0,-2));
window.rowsLaporan=json.table.rows;
});

function filterTanggal(){
let pilih=tgl.value;
let om=0, ke=0;

rowsLaporan.forEach(r=>{
let d=r.c[0]?.f||r.c[0]?.v||"";
if(d.includes("/")){
let p=d.split("/");
d=`${p[2]}-${p[1]}-${p[0]}`;
}
if(d===pilih){
om+=Number(r.c[11]?.v||0);
ke+=Number(r.c[12]?.v||0);
}
});

omset.innerText="Rp "+om;
keluar.innerText="Rp "+ke;
laba.innerText="Rp "+(om-ke);
}

// ===== PRODUK =====
const tabProduk="Stock Konter";

fetch(`https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?sheet=${encodeURIComponent(tabProduk)}`)
.then(r=>r.text())
.then(t=>{
const json=JSON.parse(t.substring(47).slice(0,-2));
const rows=json.table.rows;

// A=0 B=1 E=4 G=6
window.dataProduk=rows.map(r=>({
kode:r.c[0]?.v||"",
nama:r.c[1]?.v||"",
harga:r.c[4]?.v||"",
stok:r.c[6]?.v||""
}));

tampilProduk(dataProduk);
});

function tampilProduk(d){
hasil.innerHTML="";
d.forEach(p=>{
let status=p.stok>0?`Stok: ${p.stok}`:`<span style="color:red">Habis</span>`;
hasil.innerHTML+=`
<div class="card">
<b>${p.kode}</b><br>
${p.nama}<br>
<span class="harga">Rp ${p.harga}</span><br>
${status}
</div>`;
});
}

function filterProduk(){
let q=cari.value.toLowerCase();
tampilProduk(dataProduk.filter(x=>
x.nama.toLowerCase().includes(q)||
x.kode.toLowerCase().includes(q)
));
}
</script>

</body>
</html>
