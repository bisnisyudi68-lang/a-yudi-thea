<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Katalog LCD Profesional</title>

<style>
body{
  font-family:Arial, sans-serif;
  margin:0;
  background:#f4f6f8;
}

.header{
  background:#2eaf55;
  color:#fff;
  text-align:center;
  padding:14px;
  font-weight:bold;
}

.search{
  padding:10px;
  background:#fff;
}

.search input{
  width:100%;
  padding:12px;
  border-radius:8px;
  border:1px solid #ccc;
}

.list{
  padding:10px;
}

.item{
  background:#fff;
  border-radius:8px;
  padding:10px;
  margin-bottom:8px;
  display:flex;
  align-items:center;
  gap:10px;
}

.item input{
  transform:scale(1.2);
}

.nama{
  font-weight:bold;
}

.harga{
  color:#2eaf55;
  font-size:14px;
}

.wa{
  position:fixed;
  bottom:0;
  left:0;
  width:100%;
  padding:14px;
  border:none;
  background:#25d366;
  color:#fff;
  font-size:16px;
}
</style>
</head>

<body>

<div class="header">ðŸ”‹ Katalog LCD Profesional</div>

<div class="search">
  <input type="text" id="cari" placeholder="Cari LCD(contoh: iPhone X)" onkeyup="filter()">
</div>

<div id="list" class="list">Loading data...</div>
<div id="total" style="
  padding:10px;
  background:#fff;
  font-weight:bold;
  text-align:right;
">
Total: Rp0
</div>
<button class="wa" onclick="kirimWA()">ðŸ›’ Kirim ke WhatsApp</button>

<script>
/* =============================
   KONFIGURASI
============================= */
const JUDUL_NOTA = "Order Sparepart";
const CSV_URL =
"https://docs.google.com/spreadsheets/d/e/2PACX-1vR-bDX_S5Cwma6e7vlf8Of4XVwccJ9ukNFZODZg08gqRgjaK7gCN5xMIFIgMgAbgXw44dz8BrinQBBR/pub?gid=1950799771&single=true&output=csv";

/* =============================
   DATA & STATE
============================= */
let data = [];
let checked = {};

/* =============================
   LOAD DATA
============================= */
fetch(CSV_URL)
.then(r => r.text())
.then(t => {
  const rows = t.trim().split("\n").slice(1);
  data = rows.map((r, i) => {
    const c = r.split(",");
    return {
      id: i,
      nama: c[0],
      harga: parseInt(c[1].replace(/\D/g,"")) || 0
    };
  });
  render(data);
  updateTotal();
});

/* =============================
   RENDER LIST
============================= */
function render(arr){
  let html = "";
  arr.forEach(d => {
    html += `
    <div class="item">
      <input type="checkbox"
        data-id="${d.id}"
        ${checked[d.id] ? "checked" : ""}>
      <div>
        <div class="nama">${d.nama}</div>
        <div class="harga">Rp${d.harga.toLocaleString("id-ID")}</div>
      </div>
    </div>`;
  });
  document.getElementById("list").innerHTML = html;
}

/* =============================
   CHECKLIST (EVENT DELEGATION)
============================= */
document.addEventListener("change", e => {
  if(e.target.type === "checkbox"){
    const id = e.target.dataset.id;
    if(e.target.checked){
      checked[id] = true;
    } else {
      delete checked[id];
    }
    updateTotal();
  }
});

/* =============================
   SEARCH
============================= */
document.getElementById("cari").addEventListener("input", function(){
  const q = this.value.toLowerCase();
  render(data.filter(d =>
    d.nama.toLowerCase().includes(q)
  ));
});

/* =============================
   TOTAL HARGA
============================= */
function updateTotal(){
  let total = 0;
  Object.keys(checked).forEach(id=>{
    total += data[id].harga;
  });
  document.getElementById("total").innerText =
    "Total: Rp" + total.toLocaleString("id-ID");
}

/* =============================
   KIRIM NOTA WA
============================= */
function kirimWA(){
  let teks = `ðŸ§¾ *${JUDUL_NOTA}*%0A%0A`;
  let total = 0;

  Object.keys(checked).forEach((id, i)=>{
    const d = data[id];
    teks += `${i+1}. ${d.nama}%0ARp${d.harga.toLocaleString("id-ID")}%0A%0A`;
    total += d.harga;
  });

  if(total === 0){
    alert("Pilih produk dulu");
    return;
  }

  teks += `*TOTAL: Rp${total.toLocaleString("id-ID")}*`;

  location.href =
    "https://wa.me/6282319264646?text=" + teks;
}
</script>
</body>
</html>